#!/bin/sh

find . -type f -name '*.h' |
awk -v me="$0" '
BEGIN {
    print "# generated by " me
}

{
    sub(/^\.\//, "")
    if (/^test\//) next
    if (/^build\/test\//) next
    if ($0 == "aphros_c.h")
	printf "install(FILES %s DESTINATION ${APHROS_PREFIX}/include/%s)\n",
	    $0, dirname($0) | "sort"
    else
	printf "install(FILES %s DESTINATION ${APHROS_PREFIX}/include/aphros/%s)\n",
	    $0, dirname($0) | "sort"	
}

function dirname(s)
{
    if (sub(/\/.*/, "", s))
        return s
    else
        return ""
}

' > header.cmake

echo >&2 "update header.cmake"
