get_filename_component(name ${CMAKE_CURRENT_SOURCE_DIR} NAME)
set(T t.${name})
include_directories(${S})
add_executable(${T} main.cpp)
target_link_libraries(${T} aphros)

if (USE_BACKEND_LOCAL)
add_test_current(NAME local COMMAND ./test --backend local)
endif()
if (USE_BACKEND_CUBISM)
  add_test_current(NAME cubismnc COMMAND ./test --np 4 --backend cubismnc)
endif()
if (USE_BACKEND_NATIVE)
  if (USE_MPI)
    add_test_current(NAME native COMMAND ./test --np 4 --backend native)
  else()
    add_test_current(NAME native COMMAND ./test --np 1 --backend native)
  endif()
endif()
