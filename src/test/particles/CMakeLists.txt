get_filename_component(name ${CMAKE_CURRENT_SOURCE_DIR} NAME)
set(T t.${name})
include_directories(${S})
add_executable(${T} main.cpp)
target_link_libraries(${T} aphros)

if (USE_BACKEND_LOCAL)
add_test_current(NAME local COMMAND ap.mpirun -n 1  ./${T} --extra "set string backend local")
endif()
if (USE_BACKEND_CUBISM)
  add_test_current(NAME cubismnc COMMAND ap.mpirun -n 2  ./${T} --extra "set string backend cubismnc")
endif()
if (USE_BACKEND_NATIVE)
  if (USE_MPI)
    add_test_current(NAME native COMMAND ap.mpirun -n 2  ./${T} --extra "set string backend native")
  else()
    add_test_current(NAME native COMMAND ./${T} --extra "set string backend native\nset int px 1\nset int bx 2")
  endif()
endif()
